ui <- fluidPage(
  title = "Прогнозирование погоды Новосибирской области",
  use_shiny_title(),
  tabsetPanel(
        tabPanel("Данные",br(),
        sidebarLayout(
          sidebarPanel(
            titlePanel(
              h4("Выберите город", style="font-weight:600;text-align:center;")
            ),br(),
               dataTableOutput("files") %>% withSpinner(), tags$script(HTML('$(document).on("click", "input", function () {
                       var checkboxes = document.getElementsByName("selected");
                       var checkboxesChecked = [];
                       for (var i=0; i<checkboxes.length; i++) {
                       if (checkboxes[i].checked) {
                       checkboxesChecked.push(checkboxes[i].value);
                      }
                      }
                     Shiny.onInputChange("checked_rows",checkboxesChecked);  })')),
            br(),
               div(align="center",fluidRow(
                 column(4,actionButton("update", label = "Обновить")),
                 column(4,offset=1,downloadButton("download", "Скачать .csv"))
               )),
            br(),br(),
            verbatimTextOutput("print_data") %>% withSpinner()
            ),
          mainPanel(
            plotOutput("plot_tsred",height="300px")  %>% withSpinner(),
            plotOutput("plot_ocad",height="300px")  %>% withSpinner(),
            dataTableOutput("tabledata")  %>% withSpinner()
          ) 
        )),
        tabPanel("Построение моделей",br(),
          sidebarLayout(
            sidebarPanel(
              div(align="center",dateRangeInput("train", "Выберите период для обучающей выборки")),
              h5("Выберите одиночные модели", style="font-weight:600;text-align:center;"),
              fluidRow(style="background-color:#DCDCDC;border-radius: 5px;",
                       br(),
                column(6,
                       checkboxGroupInput("models", "",
                                 c("Модель Хольта-Винтерса","Модель ARIMA",
                                   "Модель MLP","Модель NNAR","Модель LSTM"))),
                tags$style("
                #models { 
                  margin:10px 0px 0px 10px;
                }"),
                column(6, colourInput("colHW", NULL, palette = "limited",value="#00FF00"),
                       colourInput("colAR", NULL, palette = "limited",value="#FF0000"),
                       colourInput("colMLP", NULL, palette = "limited",value="#0000FF"),
                       colourInput("colNNAR", NULL, palette = "limited",value="#FFFF00"),
                       colourInput("colLSTM", NULL, palette = "limited",value="#FF7F00")
                      )
              ),
              titlePanel(
                h5("Выберите ансамблевые модели", style="font-weight:600;text-align:center;")
                ),
              fluidRow(style="background-color:#DCDCDC;border-radius: 5px;",
                       br(),
              column(6,br(),
                     checkboxGroupInput("models_ensemble_mpol","", c("Модель полиминиальной агрегации")),
                     colourInput("colMPol", "", palette = "limited",value="#FF1493")),
              column(6,checkboxGroupInput("models_one_mpol", "Выберите модели для данного ансамбля", 
                                          c("Модель Хольта-Винтерса","Модель ARIMA",
                                            "Модель MLP","Модель NNAR", "Модель LSTM"))),
              ),
              br(),
              fluidRow(style="background-color:#DCDCDC;border-radius: 5px;",
                       br(),
                       column(6,br(),
                              checkboxGroupInput("models_ensemble_avg","",c("Модель усреднения")),
                              colourInput("colAVG", "", palette = "limited",value="#7FFFD4")),
                       column(6,checkboxGroupInput("models_one_avg", "Выберите модели для данного ансамбля", 
                                                   c("Модель Хольта-Винтерса","Модель ARIMA",
                                                     "Модель MLP","Модель NNAR","Модель LSTM")))
              ),
              br(),
              div(align="center",
              actionButton("buttontrain", label = "Построить выбранные модели")),
              br(),br(),
              verbatimTextOutput("print") %>% withSpinner()
            ),
            mainPanel(
              plotOutput("plot_train_tsred") %>% withSpinner(),
              plotOutput("plot_train_ocad") %>% withSpinner(),
              titlePanel(
                h5("Таблица метрик для средней температуры", style="font-weight:600;", align="center")
              ),
              column(12, style = "background-color:#E6E6FA;border-radius: 5px;",align="center",  tableOutput("tablemetrics_tsred")%>% withSpinner()),
              br(),
              titlePanel(
                h5("Таблица метрик для суммы осадков", style="font-weight:600;", align="center")
              ),
              
              column(12, style = "background-color:#E6E6FA;border-radius: 5px;",align="center", tableOutput("tablemetrics_ocad")%>% withSpinner()),
              
              )
            )
        ),
        tabPanel("Прогнозирование",br(),
            sidebarLayout(
              sidebarPanel(
                div(align="center",dateRangeInput("test", "Выберите период для тестовой выборки")),
                h5("Выберите модели для прогноза", style="font-weight:600;text-align:center;"),
                fluidRow(style="background-color:#DCDCDC;border-radius: 5px;",
                    br(),
                    column(6,checkboxGroupInput("models_forecast", "",
                                   c("Модель Хольта-Винтерса","Модель ARIMA",
                                     "Модель MLP","Модель NNAR","Модель LSTM","Модель полиминиальной агрегации", "Модель усреднения")),
                           tags$style("
                      #models_forecast { 
                        margin:50px 0px 0px 10px;
                          }")),
                    column(6, colourInput("coltHW", "Выберите цвет графика", palette = "limited",value="#00FF00"),
                           colourInput("coltAR", NULL, palette = "limited",value="#FF0000"),
                           colourInput("coltMLP", NULL, palette = "limited",value="#0000FF"),
                           colourInput("coltNNAR", NULL, palette = "limited",value="#FFFF00"),
                           colourInput("coltLSTM", NULL, palette = "limited",value="#FF7F00"),
                           colourInput("coltMPol", NULL, palette = "limited",value="#FF1493"),
                           colourInput("coltAVG", NULL, palette = "limited",value="#7FFFD4")
                           )
                    ),br(),
                div(align="center",actionButton("buttonforecast", label = "Построить прогноз")),
                br(),br(),
                verbatimTextOutput("print1") %>% withSpinner()
              ),
              mainPanel(
                plotOutput("plot_test_tsred") %>% withSpinner(),
                plotOutput("plot_test_ocad") %>% withSpinner(),
                titlePanel(
                  h5("Таблица метрик для средней температуры", style="font-weight:600;", align="center")
                ),
                column(12, style = "background-color:#E6E6FA;border-radius: 5px;",align="center",  tableOutput("tablemetrics_tsred_forecast")%>% withSpinner()),
                br(),
                titlePanel(
                  h5("Таблица метрик для суммы осадков", style="font-weight:600;", align="center")
                ),
                column(12, style = "background-color:#E6E6FA;border-radius: 5px;",align="center", tableOutput("tablemetrics_ocad_forecast")%>% withSpinner())
                
              )
            )
        ),
        tabPanel("Карта",
                 div(class="outer",tags$style(type = "text/css", ".outer {position: fixed; top: 41px; left: 0; right: 0; bottom: 0; overflow: hidden; padding: 0}"),
                 leafletOutput("map",width = "100%", height = "100%")),
                 absolutePanel(top = 100, right = 50,
                    fluidRow(style="background-color:white;border-radius: 5px;",
                             column(12, radioButtons("method_map", "Выберите метод:",
                                          c("Хольт-Винтерс" = "hw",
                                            "ARIMA" = "ar",
                                            "MLP" = "mlp",
                                            "NNAR" = "nnar",
                                            "LSTM" = "lstm",
                                            "Метод полиминиальной агрегации" = "mpol",
                                            "Метод усреднения" = "avg"))))
                    )
        )
))
